<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sterling Vault - Professional Banking Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1100px;
            margin: 0 auto;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
            letter-spacing: 2px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .currency-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            background: rgba(255,255,255,0.2);
            padding: 8px;
            border-radius: 20px;
        }

        .currency-btn {
            background: rgba(255,255,255,0.3);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .currency-btn.active {
            background: white;
            color: #2a5298;
        }

        .content {
            padding: 40px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2a5298;
        }

        button {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 10px;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(42, 82, 152, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        button.secondary {
            background: #6c757d;
        }

        button.danger {
            background: #dc3545;
        }

        button.success {
            background: #28a745;
        }

        button.small {
            width: auto;
            padding: 8px 16px;
            margin: 0;
            font-size: 0.9em;
        }

        .navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: none;
            color: #666;
            padding: 10px 20px;
            width: auto;
            margin: 0;
            border-bottom: 3px solid transparent;
            border-radius: 0;
            font-weight: 500;
        }

        .nav-btn.active {
            color: #2a5298;
            border-bottom-color: #2a5298;
        }

        .nav-btn:hover {
            transform: none;
            box-shadow: none;
            color: #2a5298;
        }

        .balance-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .balance-card h2 {
            font-size: 1.2em;
            font-weight: 300;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .balance-card .amount {
            font-size: 3em;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .profile-section {
            display: flex;
            gap: 30px;
            align-items: start;
            margin-bottom: 30px;
        }

        .profile-pic-container {
            text-align: center;
        }

        .profile-pic {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #2a5298;
            margin-bottom: 15px;
        }

        .profile-pic-placeholder {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            color: white;
            border: 4px solid #2a5298;
            margin-bottom: 15px;
        }

        .profile-details {
            flex: 1;
        }

        .info-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: #666;
            font-weight: 500;
        }

        .info-value {
            color: #333;
            font-weight: 600;
        }

        .transaction {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #2a5298;
        }

        .transaction.credit {
            border-left-color: #28a745;
        }

        .transaction.debit {
            border-left-color: #dc3545;
        }

        .transaction.pending {
            border-left-color: #ffc107;
            background: #fff9e6;
        }

        .transaction-info {
            flex: 1;
        }

        .transaction-type {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .transaction-date {
            font-size: 0.9em;
            color: #666;
        }

        .transaction-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            margin-top: 5px;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-approved {
            background: #d4edda;
            color: #155724;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .transaction-amount {
            font-size: 1.3em;
            font-weight: 700;
        }

        .transaction-amount.credit {
            color: #28a745;
        }

        .transaction-amount.debit {
            color: #dc3545;
        }

        .transaction-amount.pending {
            color: #ffc107;
        }

        .welcome-screen {
            text-align: center;
        }

        .welcome-screen h2 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .welcome-buttons {
            display: grid;
            gap: 15px;
            max-width: 400px;
            margin: 0 auto;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #f5c6cb;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #c3e6cb;
        }

        .loading {
            background: #d1ecf1;
            color: #0c5460;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #bee5eb;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            margin: 20px;
        }

        .user-info {
            background: #e9ecef;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1.2em;
        }

        .admin-badge {
            background: #ffc107;
            color: #333;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            display: inline-block;
            margin-left: 10px;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .user-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .user-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .user-card-info h4 {
            color: #333;
            margin-bottom: 5px;
        }

        .user-card-info p {
            color: #666;
            font-size: 0.9em;
            margin: 3px 0;
        }

        .user-card-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .file-input {
            display: none;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .pending-request {
            background: #fff9e6;
            border: 2px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .request-info h4 {
            color: #333;
            margin-bottom: 5px;
        }

        .request-info p {
            color: #666;
            font-size: 0.9em;
            margin: 3px 0;
        }

        .request-amount {
            font-size: 2em;
            font-weight: 700;
            color: #ffc107;
        }

        .request-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .blog-content {
            line-height: 1.8;
        }

        .blog-content h3 {
            color: #2a5298;
            margin: 25px 0 15px;
            font-size: 1.5em;
        }

        .blog-content p {
            color: #555;
            margin-bottom: 15px;
        }

        .blog-content ul {
            margin: 15px 0 15px 30px;
            color: #555;
        }

        .blog-content ul li {
            margin-bottom: 10px;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
        }

        .feature-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .feature-card h4 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .feature-card p {
            opacity: 0.9;
            font-size: 0.95em;
        }

        @media (max-width: 768px) {
            .profile-section {
                flex-direction: column;
                align-items: center;
            }

            .actions-grid {
                grid-template-columns: 1fr;
            }

            .user-card-header {
                flex-direction: column;
                gap: 15px;
            }

            .user-card-actions {
                width: 100%;
            }

            .user-card-actions button {
                flex: 1;
            }

            .navigation {
                overflow-x: auto;
            }

            .currency-selector {
                position: static;
                justify-content: center;
                margin-top: 15px;
            }

            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="currency-selector">
                <button class="currency-btn active" onclick="changeCurrency('GBP')">üá¨üáß GBP</button>
                <button class="currency-btn" onclick="changeCurrency('USD')">üá∫üá∏ USD</button>
            </div>
            <h1>üíé STERLING VAULT</h1>
            <p>Professional Digital Banking Platform</p>
        </div>

        <div class="content">
            <!-- Welcome Screen -->
            <div id="welcomeScreen" class="screen active">
                <div class="welcome-screen">
                    <h2>Welcome to Sterling Vault</h2>
                    <p style="color: #666; margin-bottom: 40px; font-size: 1.1em;">Secure, Professional, Reliable Banking</p>
                    <div class="welcome-buttons">
                        <button onclick="showScreen('loginScreen')">üîê Customer Sign In</button>
                        <button onclick="showScreen('adminLoginScreen')" class="success">üë®‚Äçüíº Admin Login</button>
                        <button class="secondary" onclick="showScreen('registerScreen')">üìù Create New Account</button>
                        <button style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);" onclick="showScreen('blogScreen')">üìñ About Our Platform</button>
                    </div>
                </div>
            </div>

            <!-- Registration Screen -->
            <div id="registerScreen" class="screen">
                <h2 style="color: #333; margin-bottom: 30px;">üìù Open Your Account</h2>
                <div id="registerError"></div>
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="regName" placeholder="John Smith">
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="regEmail" placeholder="john.smith@example.com">
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="tel" id="regPhone" placeholder="+44 7XXX XXXXXX">
                </div>
                <div class="form-group">
                    <label>Account Type</label>
                    <select id="regAccountType">
                        <option value="current">Current Account</option>
                        <option value="savings">Savings Account</option>
                        <option value="business">Business Account</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Create Password</label>
                    <input type="password" id="regPassword" placeholder="Minimum 6 characters">
                </div>
                <button onclick="register()" id="registerBtn">Submit Application</button>
                <button class="secondary" onclick="showScreen('welcomeScreen')">Back to Welcome</button>
            </div>

            <!-- Customer Login Screen -->
            <div id="loginScreen" class="screen">
                <h2 style="color: #333; margin-bottom: 30px;">üîê Customer Sign In</h2>
                <div id="loginError"></div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="loginEmail" placeholder="your.email@example.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password">
                </div>
                <button onclick="login()" id="loginBtn">Sign In</button>
                <button class="secondary" onclick="showScreen('welcomeScreen')">Back to Welcome</button>
            </div>

            <!-- Admin Login Screen -->
            <div id="adminLoginScreen" class="screen">
                <h2 style="color: #333; margin-bottom: 30px;">üë®‚Äçüíº Admin Login</h2>
                <div id="adminLoginError"></div>
                <div class="form-group">
                    <label>Admin Email</label>
                    <input type="email" id="adminEmail" placeholder="admin@sterlingvault.co.uk">
                </div>
                <div class="form-group">
                    <label>Admin Password</label>
                    <input type="password" id="adminPassword" placeholder="Enter admin password">
                </div>
                <button onclick="adminLogin()" class="success" id="adminLoginBtn">Admin Sign In</button>
                <button class="secondary" onclick="showScreen('welcomeScreen')">Back to Welcome</button>
                <p style="margin-top: 20px; color: #666; font-size: 0.9em;">Demo Admin: admin@sterlingvault.co.uk / admin123</p>
            </div>

            <!-- Blog/About Screen -->
            <div id="blogScreen" class="screen">
                <h2 style="color: #333; margin-bottom: 30px;">üìñ About Sterling Vault</h2>
                <div class="blog-content">
                    <p style="font-size: 1.2em; color: #2a5298; font-weight: 600;">Welcome to the future of digital banking.</p>
                    
                    <p>Sterling Vault is a cutting-edge banking platform designed to provide secure, efficient, and transparent financial services. Our platform combines traditional banking reliability with modern technological innovation.</p>

                    <h3>üè¶ Our Banking Services</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <div class="feature-icon">üí∞</div>
                            <h4>Current Accounts</h4>
                            <p>Full-featured accounts for everyday banking with instant access to your funds</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">üìà</div>
                            <h4>Savings Accounts</h4>
                            <p>Competitive interest rates to help your money grow securely</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">üíº</div>
                            <h4>Business Accounts</h4>
                            <p>Tailored solutions for businesses of all sizes</p>
                        </div>
                    </div>

                    <h3>üîí Security & Trust</h3>
                    <p>At Sterling Vault, security is our top priority. We employ bank-grade encryption and multi-layer authentication to protect your financial information. Every transaction is monitored and verified by our advanced security systems.</p>
                    
                    <ul>
                        <li><strong>256-bit SSL Encryption</strong> - All data is encrypted end-to-end</li>
                        <li><strong>Firebase Authentication</strong> - Secure cloud-based authentication</li>
                        <li><strong>24/7 Fraud Monitoring</strong> - Real-time transaction monitoring</li>
                        <li><strong>Cloud Backup</strong> - Your data is safely backed up in the cloud</li>
                    </ul>

                    <h3>üåç Multi-Currency Support</h3>
                    <p>We support both GBP (British Pound) and USD (US Dollar) transactions, making international banking seamless. Switch between currencies with a single click and manage your global finances effortlessly.</p>

                    <h3>‚ú® Key Features</h3>
                    <ul>
                        <li><strong>Instant Transactions</strong> - Real-time deposit and withdrawal processing</li>
                        <li><strong>Complete Transaction History</strong> - Full audit trail of all activities</li>
                        <li><strong>Admin Approval System</strong> - Secure transaction verification process</li>
                        <li><strong>Mobile Responsive</strong> - Bank anywhere, anytime, on any device</li>
                        <li><strong>Professional Dashboard</strong> - Intuitive interface for easy banking</li>
                        <li><strong>Cloud Storage</strong> - Data persists across all devices</li>
                    </ul>

                    <h3>üë• For Customers</h3>
                    <p>Open your account in minutes. Request deposits and withdrawals that are reviewed by our professional team. Track every transaction with detailed history and enjoy complete transparency in all your banking activities.</p>

                    <h3>üë®‚Äçüíº For Administrators</h3>
                    <p>Our admin panel provides complete oversight of all banking operations. Review and approve customer requests, fund accounts directly, monitor system health, and ensure smooth operations across the platform.</p>

                    <h3>üìû Contact & Support</h3>
                    <p>Our dedicated support team is available 24/7 to assist you with any banking needs. Whether you're opening your first account or managing complex business finances, we're here to help.</p>
                    
                    <p style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px; border-left: 4px solid #2a5298;">
                        <strong>Ready to start banking with Sterling Vault?</strong><br>
                        Create your account today and experience the future of digital banking.
                    </p>
                </div>
                <button class="secondary" onclick="showScreen('welcomeScreen')" style="margin-top: 30px;">Back to Welcome</button>
            </div>

            <!-- Customer Dashboard -->
            <div id="dashboardScreen" class="screen">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar"></div>
                    <div>
                        <strong>Welcome back, <span id="userName"></span></strong>
                        <p style="margin-top: 5px; color: #666;">Account: <span id="userAccountNumber"></span></p>
                    </div>
                </div>

                <div class="navigation">
                    <button class="nav-btn active" onclick="switchTab('overview')">Overview</button>
                    <button class="nav-btn" onclick="switchTab('transactions')">Transactions</button>
                    <button class="nav-btn" onclick="switchTab('profile')">Profile</button>
                    <button class="nav-btn" onclick="switchTab('settings')">Settings</button>
                </div>

                <!-- Overview Tab -->
                <div id="overviewTab" class="tab-content active">
                    <div class="balance-card">
                        <h2>Available Balance</h2>
                        <div class="amount" id="balance">¬£0.00</div>
                        <p style="opacity: 0.9;"><span id="accountType"></span></p>
                    </div>

                    <div class="actions-grid">
                        <button onclick="showModal('depositRequestModal')">üí∞ Request Deposit</button>
                        <button onclick="showModal('withdrawRequestModal')">üí∏ Request Withdrawal</button>
                    </div>

                    <h3 style="margin: 30px 0 20px; color: #333;">Recent Activity</h3>
                    <div id="recentTransactions"></div>
                </div>

                <!-- Transactions Tab -->
                <div id="transactionsTab" class="tab-content">
                    <h3 style="margin-bottom: 20px; color: #333;">All Transactions</h3>
                    <div id="allTransactions"></div>
                </div>

                <!-- Profile Tab -->
                <div id="profileTab" class="tab-content">
                    <h3 style="margin-bottom: 20px; color: #333;">My Profile</h3>
                    <div class="profile-section">
                        <div class="profile-pic-container">
                            <div id="profilePicDisplay"></div>
                            <input type="file" id="profilePicInput" class="file-input" accept="image/*" onchange="uploadProfilePic()">
                            <button class="small" onclick="document.getElementById('profilePicInput').click()">Change Photo</button>
                        </div>
                        <div class="profile-details">
                            <div class="info-card">
                                <div class="info-row">
                                    <span class="info-label">Full Name</span>
                                    <span class="info-value" id="profileName"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Email</span>
                                    <span class="info-value" id="profileEmail"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Phone</span>
                                    <span class="info-value" id="profilePhone"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Account Number</span>
                                    <span class="info-value" id="profileAccount"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Account Type</span>
                                    <span class="info-value" id="profileType"></span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Member Since</span>
                                    <span class="info-value" id="profileDate"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settingsTab" class="tab-content">
                    <h3 style="margin-bottom: 20px; color: #333;">Account Settings</h3>
                    <div id="settingsError"></div>
                    <div class="info-card">
                        <h4 style="margin-bottom: 20px; color: #333;">Change Password</h4>
                        <div class="form-group">
                            <label>Current Password</label>
                            <input type="password" id="currentPassword" placeholder="Enter current password">
                        </div>
                        <div class="form-group">
                            <label>New Password</label>
                            <input type="password" id="newPassword" placeholder="Enter new password">
                        </div>
                        <div class="form-group">
                            <label>Confirm New Password</label>
                            <input type="password" id="confirmPassword" placeholder="Confirm new password">
                        </div>
                        <button onclick="changePassword()">Update Password</button>
                    </div>
                </div>

                <button class="secondary" onclick="logout()" style="margin-top: 30px;">Sign Out</button>
            </div>

            <!-- Admin Dashboard -->
            <div id="adminDashboardScreen" class="screen">
                <div class="user-info">
                    <div class="user-avatar">üë®‚Äçüíº</div>
                    <div>
                        <strong>Admin Panel <span class="admin-badge">ADMIN</span></strong>
                        <p style="margin-top: 5px; color: #666;">System Administrator</p>
                    </div>
                </div>

                <div class="navigation">
                    <button class="nav-btn active" onclick="switchAdminTab('dashboard')">Dashboard</button>
                    <button class="nav-btn" onclick="switchAdminTab('customers')">Customers</button>
                    <button class="nav-btn" onclick="switchAdminTab('requests')">Pending Requests</button>
                </div>

                <!-- Admin Dashboard Tab -->
                <div id="adminDashboardTab" class="tab-content active">
                    <div class="admin-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="totalCustomers">0</div>
                            <div class="stat-label">Total Customers</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalBalance">¬£0</div>
                            <div class="stat-label">Total Deposits</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="pendingRequestsCount">0</div>
                            <div class="stat-label">Pending Requests</div>
                        </div>
                    </div>
                    <h3 style="margin: 30px 0 20px; color: #333;">System Overview</h3>
                    <div class="info-card">
                        <p style="color: #666;">Monitor all banking activities, manage customer accounts, and approve transaction requests from this central dashboard. All data is stored securely in Firebase Cloud.</p>
                    </div>
                </div>

                <!-- Customers Tab -->
                <div id="adminCustomersTab" class="tab-content">
                    <h3 style="margin-bottom: 20px; color: #333;">All Customers</h3>
                    <div id="customersList"></div>
                </div>

                <!-- Pending Requests Tab -->
                <div id="adminRequestsTab" class="tab-content">
                    <h3 style="margin-bottom: 20px; color: #333;">Pending Transaction Requests</h3>
                    <div id="pendingRequestsList"></div>
                </div>

                <button class="secondary" onclick="adminLogout()" style="margin-top: 30px;">Admin Logout</button>
            </div>
        </div>
    </div>

    <!-- Deposit Request Modal -->
    <div id="depositRequestModal" class="modal">
        <div class="modal-content">
            <h2 style="color: #333; margin-bottom: 20px;">üí∞ Request Deposit</h2>
            <div id="depositRequestError"></div>
            <p style="color: #666; margin-bottom: 20px;">Your deposit request will be reviewed by an administrator</p>
            <div class="form-group">
                <label>Amount</label>
                <input type="number" id="depositRequestAmount" placeholder="0.00" min="0.01" step="0.01">
            </div>
            <div class="form-group">
                <label>Notes (Optional)</label>
                <textarea id="depositRequestNotes" rows="3" placeholder="Add any additional information..."></textarea>
            </div>
            <button onclick="requestDeposit()">Submit Request</button>
            <button class="secondary" onclick="closeModal('depositRequestModal')">Cancel</button>
        </div>
    </div>

    <!-- Withdraw Request Modal -->
    <div id="withdrawRequestModal" class="modal">
        <div class="modal-content">
            <h2 style="color: #333; margin-bottom: 20px;">üí∏ Request Withdrawal</h2>
            <div id="withdrawRequestError"></div>
            <p style="color: #666; margin-bottom: 20px;">Your withdrawal request will be reviewed by an administrator</p>
            <div class="form-group">
                <label>Amount</label>
                <input type="number" id="withdrawRequestAmount" placeholder="0.00" min="0.01" step="0.01">
            </div>
            <div class="form-group">
                <label>Reason</label>
                <textarea id="withdrawRequestNotes" rows="3" placeholder="Please provide a reason for withdrawal..."></textarea>
            </div>
            <button onclick="requestWithdraw()">Submit Request</button>
            <button class="secondary" onclick="closeModal('withdrawRequestModal')">Cancel</button>
        </div>
    </div>

    <!-- Admin Fund Account Modal -->
    <div id="adminFundModal" class="modal">
        <div class="modal-content">
            <h2 style="color: #333; margin-bottom: 20px;">üí∞ Fund Customer Account</h2>
            <div id="adminFundError"></div>
            <p style="color: #666; margin-bottom: 20px;">Customer: <strong id="fundCustomerName"></strong></p>
            <p style="color: #666; margin-bottom: 20px;">Account: <strong id="fundCustomerAccount"></strong></p>
            <div class="form-group">
                <label>Amount</label>
                <input type="number" id="adminFundAmount" placeholder="0.00" min="0.01" step="0.01">
            </div>
            <div class="form-group">
                <label>Notes</label>
                <textarea id="adminFundNotes" rows="3" placeholder="Reason for funding..."></textarea>
            </div>
            <button onclick="adminFundAccount()" class="success">Add Funds</button>
            <button class="secondary" onclick="closeModal('adminFundModal')">Cancel</button>
        </div>
    </div>

    <!-- View Customer Details Modal -->
    <div id="customerDetailsModal" class="modal">
        <div class="modal-content">
            <h2 style="color: #333; margin-bottom: 20px;">üìä Customer Details</h2>
            <div id="customerDetailsContent"></div>
            <button class="secondary" onclick="closeModal('customerDetailsModal')">Close</button>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, collection, getDocs, updateDoc, query, where, onSnapshot, deleteDoc, addDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCTgH_etsVkjjuzAwAHosL4mFSwxvxrMyc",
            authDomain: "sterlingvault-321f5.firebaseapp.com",
            projectId: "sterlingvault-321f5",
            storageBucket: "sterlingvault-321f5.firebasestorage.app",
            messagingSenderId: "121219945043",
            appId: "1:121219945043:web:72915e4ff50ba54541eca6"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Make Firebase available globally
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseStorage = storage;
        window.firebaseModules = {
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged,
            doc,
            setDoc,
            getDoc,
            collection,
            getDocs,
            updateDoc,
            query,
            where,
            onSnapshot,
            deleteDoc,
            addDoc,
            ref,
            uploadBytes,
            getDownloadURL
        };

        console.log('üî• Firebase initialized successfully!');
    </script>

    <script>
        // Global variables
        let currentUser = null;
        let currentUserData = null;
        let isAdmin = false;
        let selectedCustomer = null;
        let currentCurrency = 'GBP';
        let currencySymbol = '¬£';
        let unsubscribeListener = null;

        // Wait for Firebase to be ready
        setTimeout(initializeApp, 1000);

        function initializeApp() {
            console.log('üöÄ Initializing Sterling Vault...');
            
            // Check authentication state
            window.firebaseModules.onAuthStateChanged(window.firebaseAuth, (user) => {
                if (user && !isAdmin) {
                    console.log('‚úÖ User authenticated:', user.email);
                    currentUser = user.uid;
                    loadUserData(user.uid);
                } else if (!user && !isAdmin) {
                    console.log('‚ùå No user authenticated');
                    currentUser = null;
                    currentUserData = null;
                }
            });
        }

        // Helper functions
        function generateAccountNumber() {
            const sortCode = '20-00-00';
            const accountNum = Math.floor(10000000 + Math.random() * 90000000);
            return `${sortCode}-${accountNum}`;
        }

        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase();
        }

        function changeCurrency(currency) {
            currentCurrency = currency;
            currencySymbol = currency === 'GBP' ? '¬£' : '$';
            
            document.querySelectorAll('.currency-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (currentUserData && !isAdmin) {
                loadDashboard();
            }
            if (isAdmin) {
                updateAdminStats();
            }
        }

        function formatAmount(amount) {
            return `${currencySymbol}${amount.toFixed(2)}`;
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            const errorId = modalId.replace('Modal', 'Error');
            if (document.getElementById(errorId)) {
                document.getElementById(errorId).innerHTML = '';
            }
        }

        function showError(elementId, message) {
            const el = document.getElementById(elementId);
            if (el) el.innerHTML = `<div class="error">${message}</div>`;
        }

        function showSuccess(elementId, message) {
            const el = document.getElementById(elementId);
            if (el) el.innerHTML = `<div class="success">${message}</div>`;
        }

        function showLoading(elementId, message) {
            const el = document.getElementById(elementId);
            if (el) el.innerHTML = `<div class="loading">${message}</div>`;
        }

        function switchTab(tab) {
            document.querySelectorAll('#dashboardScreen .nav-btn').forEach(btn => btn.classList.remove('active'));
            if (event && event.target) event.target.classList.add('active');
            
            document.querySelectorAll('#dashboardScreen .tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tab + 'Tab').classList.add('active');
            
            if (tab === 'transactions') loadAllTransactions();
            if (tab === 'profile') loadProfile();
        }

        function switchAdminTab(tab) {
            document.querySelectorAll('#adminDashboardScreen .nav-btn').forEach(btn => btn.classList.remove('active'));
            if (event && event.target) event.target.classList.add('active');
            
            document.querySelectorAll('#adminDashboardScreen .tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('admin' + tab.charAt(0).toUpperCase() + tab.slice(1) + 'Tab').classList.add('active');
            
            if (tab === 'customers') loadCustomers();
            if (tab === 'requests') loadPendingRequests();
            if (tab === 'dashboard') updateAdminStats();
        }

        // Registration with Firebase
        async function register() {
            const name = document.getElementById('regName').value.trim();
            const email = document.getElementById('regEmail').value.trim().toLowerCase();
            const phone = document.getElementById('regPhone').value.trim();
            const password = document.getElementById('regPassword').value;
            const accountType = document.getElementById('regAccountType').value;
            const btn = document.getElementById('registerBtn');

            if (!name || !email || !password || !phone) {
                showError('registerError', '‚ö†Ô∏è Please fill in all required fields');
                return;
            }

            if (password.length < 6) {
                showError('registerError', '‚ö†Ô∏è Password must be at least 6 characters');
                return;
            }

            btn.disabled = true;
            showLoading('registerError', '‚è≥ Creating your account...');

            try {
                // Create Firebase Auth user
                const userCredential = await window.firebaseModules.createUserWithEmailAndPassword(
                    window.firebaseAuth, 
                    email, 
                    password
                );
                
                const user = userCredential.user;
                const accountNumber = generateAccountNumber();

                // Create user document in Firestore
                const userDoc = {
                    name,
                    email,
                    phone,
                    accountType,
                    accountNumber,
                    balance: 0,
                    createdDate: new Date().toISOString(),
                    profilePicUrl: null,
                    uid: user.uid
                };

                await window.firebaseModules.setDoc(
                    window.firebaseModules.doc(window.firebaseDb, 'users', user.uid),
                    userDoc
                );

                showSuccess('registerError', '‚úÖ Account created successfully! Redirecting to login...');
                
                setTimeout(() => {
                    document.getElementById('regName').value = '';
                    document.getElementById('regEmail').value = '';
                    document.getElementById('regPhone').value = '';
                    document.getElementById('regPassword').value = '';
                    showScreen('loginScreen');
                    document.getElementById('registerError').innerHTML = '';
                    btn.disabled = false;
                }, 2000);

            } catch (error) {
                console.error('Registration error:', error);
                let errorMsg = 'Registration failed. Please try again.';
                if (error.code === 'auth/email-already-in-use') {
                    errorMsg = '‚ùå This email is already registered. Please login instead.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMsg = '‚ùå Invalid email address.';
                } else if (error.code === 'auth/weak-password') {
                    errorMsg = '‚ùå Password is too weak. Use at least 6 characters.';
                }
                showError('registerError', errorMsg);
                btn.disabled = false;
            }
        }

        // Login with Firebase
        async function login() {
            const email = document.getElementById('loginEmail').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;
            const btn = document.getElementById('loginBtn');

            if (!email || !password) {
                showError('loginError', '‚ö†Ô∏è Please enter your email and password');
                return;
            }

            btn.disabled = true;
            showLoading('loginError', '‚è≥ Signing in...');

            try {
                const userCredential = await window.firebaseModules.signInWithEmailAndPassword(
                    window.firebaseAuth,
                    email,
                    password
                );

                showSuccess('loginError', '‚úÖ Login successful! Loading your account...');
                
                currentUser = userCredential.user.uid;
                await loadUserData(currentUser);
                
                setTimeout(() => {
                    document.getElementById('loginEmail').value = '';
                    document.getElementById('loginPassword').value = '';
                    document.getElementById('loginError').innerHTML = '';
                    loadDashboard();
                    showScreen('dashboardScreen');
                    btn.disabled = false;
                }, 1000);

            } catch (error) {
                console.error('Login error:', error);
                let errorMsg = '‚ùå Invalid email or password. Please try again.';
                if (error.code === 'auth/user-not-found') {
                    errorMsg = '‚ùå No account found with this email. Please register first.';
                } else if (error.code === 'auth/wrong-password') {
                    errorMsg = '‚ùå Incorrect password. Please try again.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMsg = '‚ùå Invalid email address.';
                }
                showError('loginError', errorMsg);
                btn.disabled = false;
            }
        }

        // Admin Login (simple check, no Firebase auth)
        async function adminLogin() {
            const email = document.getElementById('adminEmail').value.trim().toLowerCase();
            const password = document.getElementById('adminPassword').value;
            const btn = document.getElementById('adminLoginBtn');

            if (!email || !password) {
                showError('adminLoginError', '‚ö†Ô∏è Please enter admin credentials');
                return;
            }

            if (email === 'admin@sterlingvault.co.uk' && password === 'admin123') {
                btn.disabled = true;
                showSuccess('adminLoginError', '‚úÖ Admin login successful! Loading dashboard...');
                
                isAdmin = true;
                
                setTimeout(() => {
                    document.getElementById('adminEmail').value = '';
                    document.getElementById('adminPassword').value = '';
                    document.getElementById('adminLoginError').innerHTML = '';
                    loadAdminDashboard();
                    showScreen('adminDashboardScreen');
                    btn.disabled = false;
                }, 1000);
            } else {
                showError('adminLoginError', '‚ùå Invalid admin credentials');
            }
        }

        // Load user data from Firestore
        async function loadUserData(uid) {
            try {
                const userDocRef = window.firebaseModules.doc(window.firebaseDb, 'users', uid);
                const userDoc = await window.firebaseModules.getDoc(userDocRef);
                
                if (userDoc.exists()) {
                    currentUserData = userDoc.data();
                    console.log('‚úÖ User data loaded:', currentUserData);
                } else {
                    console.error('‚ùå User document not found');
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Load Dashboard
        function loadDashboard() {
            if (!currentUserData) return;

            document.getElementById('userName').textContent = currentUserData.name;
            document.getElementById('userAccountNumber').textContent = currentUserData.accountNumber;
            document.getElementById('balance').textContent = formatAmount(currentUserData.balance);
            document.getElementById('accountType').textContent = 
                currentUserData.accountType.charAt(0).toUpperCase() + currentUserData.accountType.slice(1) + ' Account';
            document.getElementById('userAvatar').textContent = getInitials(currentUserData.name);
            
            loadRecentTransactions();
        }

        // Load Recent Transactions
        async function loadRecentTransactions() {
            const list = document.getElementById('recentTransactions');
            
            try {
                const transRef = window.firebaseModules.collection(window.firebaseDb, 'users', currentUser, 'transactions');
                const transSnap = await window.firebaseModules.getDocs(transRef);
                
                if (transSnap.empty) {
                    list.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No transactions yet</p>';
                    return;
                }

                const transactions = [];
                transSnap.forEach(doc => {
                    transactions.push({ id: doc.id, ...doc.data() });
                });

                transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
                const recent = transactions.slice(0, 5);
                
                list.innerHTML = recent.map(t => formatTransaction(t)).join('');
            } catch (error) {
                console.error('Error loading transactions:', error);
                list.innerHTML = '<p style="color: #dc3545; text-align: center; padding: 20px;">Error loading transactions</p>';
            }
        }

        // Load All Transactions
        async function loadAllTransactions() {
            const list = document.getElementById('allTransactions');
            
            try {
                const transRef = window.firebaseModules.collection(window.firebaseDb, 'users', currentUser, 'transactions');
                const transSnap = await window.firebaseModules.getDocs(transRef);
                
                if (transSnap.empty) {
                    list.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No transactions yet</p>';
                    return;
                }

                const transactions = [];
                transSnap.forEach(doc => {
                    transactions.push({ id: doc.id, ...doc.data() });
                });

                transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                list.innerHTML = transactions.map(t => formatTransaction(t)).join('');
            } catch (error) {
                console.error('Error loading transactions:', error);
                list.innerHTML = '<p style="color: #dc3545; text-align: center; padding: 20px;">Error loading transactions</p>';
            }
        }

        // Format Transaction
        function formatTransaction(t) {
            const date = new Date(t.date);
            const formattedDate = date.toLocaleDateString('en-GB', { 
                day: '2-digit', 
                month: 'short', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            let statusBadge = '';
            if (t.status === 'pending') {
                statusBadge = '<span class="transaction-status status-pending">‚è≥ Pending</span>';
            } else if (t.status === 'approved') {
                statusBadge = '<span class="transaction-status status-approved">‚úÖ Approved</span>';
            } else if (t.status === 'rejected') {
                statusBadge = '<span class="transaction-status status-rejected">‚ùå Rejected</span>';
            }

            const className = t.status === 'pending' ? 'pending' : (t.isCredit ? 'credit' : 'debit');
            const amountClass = t.status === 'pending' ? 'pending' : (t.isCredit ? 'credit' : 'debit');
            
            return `
                <div class="transaction ${className}">
                    <div class="transaction-info">
                        <div class="transaction-type">${t.type}</div>
                        <div class="transaction-date">${formattedDate}</div>
                        ${statusBadge}
                    </div>
                    <div class="transaction-amount ${amountClass}">
                        ${t.isCredit ? '+' : '-'}${formatAmount(t.amount)}
                    </div>
                </div>
            `;
        }

        // Load Profile
        function loadProfile() {
            if (!currentUserData) return;

            document.getElementById('profileName').textContent = currentUserData.name;
            document.getElementById('profileEmail').textContent = currentUserData.email;
            document.getElementById('profilePhone').textContent = currentUserData.phone || 'Not provided';
            document.getElementById('profileAccount').textContent = currentUserData.accountNumber;
            document.getElementById('profileType').textContent = 
                currentUserData.accountType.charAt(0).toUpperCase() + currentUserData.accountType.slice(1) + ' Account';
            
            const date = new Date(currentUserData.createdDate);
            document.getElementById('profileDate').textContent = date.toLocaleDateString('en-GB', {
                day: '2-digit',
                month: 'long',
                year: 'numeric'
            });

            const picDisplay = document.getElementById('profilePicDisplay');
            if (currentUserData.profilePicUrl) {
                picDisplay.innerHTML = `<img src="${currentUserData.profilePicUrl}" class="profile-pic" alt="Profile">`;
            } else {
                picDisplay.innerHTML = `<div class="profile-pic-placeholder">${getInitials(currentUserData.name)}</div>`;
            }
        }

        // Upload Profile Picture to Firebase Storage
        async function uploadProfilePic() {
            const file = document.getElementById('profilePicInput').files[0];
            if (!file) return;

            try {
                const storageRef = window.firebaseModules.ref(window.firebaseStorage, `profile-pics/${currentUser}`);
                await window.firebaseModules.uploadBytes(storageRef, file);
                const downloadURL = await window.firebaseModules.getDownloadURL(storageRef);

                // Update Firestore
                const userDocRef = window.firebaseModules.doc(window.firebaseDb, 'users', currentUser);
                await window.firebaseModules.updateDoc(userDocRef, {
                    profilePicUrl: downloadURL
                });

                currentUserData.profilePicUrl = downloadURL;
                loadProfile();
                
                alert('‚úÖ Profile picture updated successfully!');
            } catch (error) {
                console.error('Error uploading profile picture:', error);
                alert('‚ùå Failed to upload profile picture. Please try again.');
            }
        }

        // Change Password
        async function changePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;

            if (!current || !newPass || !confirm) {
                showError('settingsError', '‚ö†Ô∏è Please fill in all password fields');
                return;
            }

            if (newPass.length < 6) {
                showError('settingsError', '‚ö†Ô∏è New password must be at least 6 characters');
                return;
            }

            if (newPass !== confirm) {
                showError('settingsError', '‚ö†Ô∏è New passwords do not match');
                return;
            }

            try {
                // Re-authenticate user first
                const user = window.firebaseAuth.currentUser;
                const credential = window.firebaseModules.EmailAuthProvider.credential(user.email, current);
                await user.reauthenticateWithCredential(credential);

                // Update password
                await user.updatePassword(newPass);

                showSuccess('settingsError', '‚úÖ Password updated successfully!');
                
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
            } catch (error) {
                console.error('Password change error:', error);
                showError('settingsError', '‚ùå Failed to change password. Current password may be incorrect.');
            }
        }

        // Request Deposit
        async function requestDeposit() {
            const amount = parseFloat(document.getElementById('depositRequestAmount').value);
            const notes = document.getElementById('depositRequestNotes').value.trim();
            
            if (!amount || amount <= 0) {
                showError('depositRequestError', '‚ö†Ô∏è Please enter a valid amount');
                return;
            }

            try {
                showLoading('depositRequestError', '‚è≥ Submitting request...');

                // Add transaction to user's subcollection
                const transRef = window.firebaseModules.collection(window.firebaseDb, 'users', currentUser, 'transactions');
                await window.firebaseModules.addDoc(transRef, {
                    type: 'Deposit Request',
                    amount: amount,
                    date: new Date().toISOString(),
                    isCredit: true,
                    status: 'pending',
                    notes: notes || ''
                });

                // Add to pending requests collection
                const requestsRef = window.firebaseModules.collection(window.firebaseDb, 'pendingRequests');
                await window.firebaseModules.addDoc(requestsRef, {
                    userId: currentUser,
                    userEmail: currentUserData.email,
                    userName: currentUserData.name,
                    type: 'deposit',
                    amount: amount,
                    notes: notes || '',
                    date: new Date().toISOString(),
                    status: 'pending'
                });

                showSuccess('depositRequestError', '‚úÖ Deposit request submitted successfully!');
                
                setTimeout(() => {
                    closeModal('depositRequestModal');
                    document.getElementById('depositRequestAmount').value = '';
                    document.getElementById('depositRequestNotes').value = '';
                    loadDashboard();
                }, 1500);

            } catch (error) {
                console.error('Deposit request error:', error);
                showError('depositRequestError', '‚ùå Failed to submit request. Please try again.');
            }
        }

        // Request Withdrawal
        async function requestWithdraw() {
            const amount = parseFloat(document.getElementById('withdrawRequestAmount').value);
            const notes = document.getElementById('withdrawRequestNotes').value.trim();
            
            if (!amount || amount <= 0) {
                showError('withdrawRequestError', '‚ö†Ô∏è Please enter a valid amount');
                return;
            }

            if (amount > currentUserData.balance) {
                showError('withdrawRequestError', '‚ö†Ô∏è Insufficient funds');
                return;
            }

            if (!notes) {
                showError('withdrawRequestError', '‚ö†Ô∏è Please provide a reason for withdrawal');
                return;
            }

            try {
                showLoading('withdrawRequestError', '‚è≥ Submitting request...');

                // Add transaction
                const transRef = window.firebaseModules.collection(window.firebaseDb, 'users', currentUser, 'transactions');
                await window.firebaseModules.addDoc(transRef, {
                    type: 'Withdrawal Request',
                    amount: amount,
                    date: new Date().toISOString(),
                    isCredit: false,
                    status: 'pending',
                    notes: notes
                });

                // Add to pending requests
                const requestsRef = window.firebaseModules.collection(window.firebaseDb, 'pendingRequests');
                await window.firebaseModules.addDoc(requestsRef, {
                    userId: currentUser,
                    userEmail: currentUserData.email,
                    userName: currentUserData.name,
                    type: 'withdrawal',
                    amount: amount,
                    notes: notes,
                    date: new Date().toISOString(),
                    status: 'pending'
                });

                showSuccess('withdrawRequestError', '‚úÖ Withdrawal request submitted successfully!');
                
                setTimeout(() => {
                    closeModal('withdrawRequestModal');
                    document.getElementById('withdrawRequestAmount').value = '';
                    document.getElementById('withdrawRequestNotes').value = '';
                    loadDashboard();
                }, 1500);

            } catch (error) {
                console.error('Withdrawal request error:', error);
                showError('withdrawRequestError', '‚ùå Failed to submit request. Please try again.');
            }
        }

        // Admin Dashboard
        async function loadAdminDashboard() {
            await updateAdminStats();
        }

        async function updateAdminStats() {
            try {
                const usersRef = window.firebaseModules.collection(window.firebaseDb, 'users');
                const usersSnap = await window.firebaseModules.getDocs(usersRef);
                
                let totalBalance = 0;
                usersSnap.forEach(doc => {
                    totalBalance += doc.data().balance || 0;
                });

                const requestsRef = window.firebaseModules.collection(window.firebaseDb, 'pendingRequests');
                const q = window.firebaseModules.query(requestsRef, window.firebaseModules.where('status', '==', 'pending'));
                const requestsSnap = await window.firebaseModules.getDocs(q);

                document.getElementById('totalCustomers').textContent = usersSnap.size;
                document.getElementById('totalBalance').textContent = formatAmount(totalBalance);
                document.getElementById('pendingRequestsCount').textContent = requestsSnap.size;

            } catch (error) {
                console.error('Error loading admin stats:', error);
            }
        }

        async function loadCustomers() {
            const list = document.getElementById('customersList');
            
            try {
                const usersRef = window.firebaseModules.collection(window.firebaseDb, 'users');
                const usersSnap = await window.firebaseModules.getDocs(usersRef);
                
                if (usersSnap.empty) {
                    list.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No customers yet</p>';
                    return;
                }

                const customers = [];
                usersSnap.forEach(doc => {
                    customers.push({ id: doc.id, ...doc.data() });
                });

                list.innerHTML = customers.map(acc => `
                    <div class="user-card">
                        <div class="user-card-header">
                            <div class="user-card-info">
                                <h4>${acc.name}</h4>
                                <p>üìß ${acc.email}</p>
                                <p>üìû ${acc.phone || 'No phone'}</p>
                                <p>üè¶ ${acc.accountNumber}</p>
                                <p>üí∞ Balance: <strong>${formatAmount(acc.balance || 0)}</strong></p>
                                <p style="color: #999; font-size: 0.85em;">Joined: ${new Date(acc.createdDate).toLocaleDateString('en-GB')}</p>
                            </div>
                            <div class="user-card-actions">
                                <button class="success small" onclick="showFundModal('${acc.id}', '${acc.name}', '${acc.accountNumber}')">üí∞ Fund</button>
                                <button class="small" onclick="viewCustomerDetails('${acc.id}')">üìä Details</button>
                            </div>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Error loading customers:', error);
                list.innerHTML = '<p style="color: #dc3545; text-align: center; padding: 20px;">Error loading customers</p>';
            }
        }

        function showFundModal(userId, userName, accountNumber) {
            selectedCustomer = userId;
            document.getElementById('fundCustomerName').textContent = userName;
            document.getElementById('fundCustomerAccount').textContent = accountNumber;
            showModal('adminFundModal');
        }

        async function adminFundAccount() {
            const amount = parseFloat(document.getElementById('adminFundAmount').value);
            const notes = document.getElementById('adminFundNotes').value.trim();

            if (!amount || amount <= 0) {
                showError('adminFundError', '‚ö†Ô∏è Please enter a valid amount');
                return;
            }

            if (!notes) {
                showError('adminFundError', '‚ö†Ô∏è Please provide a reason');
                return;
            }

            try {
                showLoading('adminFundError', '‚è≥ Processing...');

                // Update user balance
                const userDocRef = window.firebaseModules.doc(window.firebaseDb, 'users', selectedCustomer);
                const userDoc = await window.firebaseModules.getDoc(userDocRef);
                const currentBalance = userDoc.data().balance || 0;

                await window.firebaseModules.updateDoc(userDocRef, {
                    balance: currentBalance + amount
                });

                // Add transaction
                const transRef = window.firebaseModules.collection(window.firebaseDb, 'users', selectedCustomer, 'transactions');
                await window.firebaseModules.addDoc(transRef, {
                    type: 'Admin Credit - ' + notes,
                    amount: amount,
                    date: new Date().toISOString(),
                    isCredit: true,
                    status: 'approved'
                });

                showSuccess('adminFundError', '‚úÖ Account funded successfully!');
                
                setTimeout(() => {
                    closeModal('adminFundModal');
                    document.getElementById('adminFundAmount').value = '';
                    document.getElementById('adminFundNotes').value = '';
                    loadCustomers();
                    updateAdminStats();
                }, 1500);

            } catch (error) {
                console.error('Fund account error:', error);
                showError('adminFundError', '‚ùå Failed to fund account. Please try again.');
            }
        }

        async function viewCustomerDetails(userId) {
            try {
                const userDocRef = window.firebaseModules.doc(window.firebaseDb, 'users', userId);
                const userDoc = await window.firebaseModules.getDoc(userDocRef);
                const userData = userDoc.data();

                const transRef = window.firebaseModules.collection(window.firebaseDb, 'users', userId, 'transactions');
                const transSnap = await window.firebaseModules.getDocs(transRef);
                
                const transactions = [];
                transSnap.forEach(doc => {
                    transactions.push({ id: doc.id, ...doc.data() });
                });
                transactions.sort((a, b) => new Date(b.date) - new Date(a.date));

                const transHistory = transactions.length > 0 
                    ? transactions.map(t => `
                        <div style="padding: 10px; background: #f8f9fa; margin: 5px 0; border-radius: 5px;">
                            <strong>${t.type}</strong> - ${formatAmount(t.amount)}<br>
                            <small>${new Date(t.date).toLocaleString('en-GB')}</small>
                            ${t.status ? `<span class="transaction-status status-${t.status}">${t.status}</span>` : ''}
                        </div>
                    `).join('')
                    : '<p style="color: #666;">No transactions yet</p>';

                const content = document.getElementById('customerDetailsContent');
                content.innerHTML = `
                    <div class="info-card">
                        <h3 style="color: #2a5298; margin-bottom: 20px;">${userData.name}</h3>
                        <div class="info-row">
                            <span class="info-label">Email</span>
                            <span class="info-value">${userData.email}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Phone</span>
                            <span class="info-value">${userData.phone || 'Not provided'}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Account Number</span>
                            <span class="info-value">${userData.accountNumber}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Account Type</span>
                            <span class="info-value">${userData.accountType}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Balance</span>
                            <span class="info-value">${formatAmount(userData.balance || 0)}</span>

   </div>
                        <div class="info-row">
                            <span class="info-label">Total Transactions</span>
                            <span class="info-value">${transactions.length}</span>
                        </div>
                    </div>
                    <h4 style="margin: 20px 0 10px; color: #333;">Transaction History</h4>
                    <div style="max-height: 300px; overflow-y: auto;">
                        ${transHistory}
                    </div>
                `;
                
                showModal('customerDetailsModal');

            } catch (error) {
                console.error('Error viewing customer details:', error);
                alert('‚ùå Failed to load customer details');
            }
        }

        async function loadPendingRequests() {
            const list = document.getElementById('pendingRequestsList');
            
            try {
                const requestsRef = window.firebaseModules.collection(window.firebaseDb, 'pendingRequests');
                const q = window.firebaseModules.query(requestsRef, window.firebaseModules.where('status', '==', 'pending'));
                const requestsSnap = await window.firebaseModules.getDocs(q);
                
                if (requestsSnap.empty) {
                    list.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">No pending requests</p>';
                    return;
                }

                const requests = [];
                requestsSnap.forEach(doc => {
                    requests.push({ id: doc.id, ...doc.data() });
                });

                list.innerHTML = requests.map(req => {
                    const date = new Date(req.date);
                    const formattedDate = date.toLocaleDateString('en-GB', {
                        day: '2-digit',
                        month: 'short',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });

                    return `
                        <div class="pending-request">
                            <div class="request-header">
                                <div class="request-info">
                                    <h4>${req.type === 'deposit' ? 'üí∞ Deposit' : 'üí∏ Withdrawal'} Request</h4>
                                    <p><strong>Customer:</strong> ${req.userName}</p>
                                    <p><strong>Email:</strong> ${req.userEmail}</p>
                                    <p><strong>Date:</strong> ${formattedDate}</p>
                                    ${req.notes ? `<p><strong>Notes:</strong> ${req.notes}</p>` : ''}
                                </div>
                                <div class="request-amount">${formatAmount(req.amount)}</div>
                            </div>
                            <div class="request-actions">
                                <button class="success small" onclick="approveRequest('${req.id}', '${req.userId}', '${req.type}', ${req.amount})">‚úÖ Approve</button>
                                <button class="danger small" onclick="rejectRequest('${req.id}', '${req.userId}', '${req.type}', ${req.amount})">‚ùå Reject</button>
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                console.error('Error loading pending requests:', error);
                list.innerHTML = '<p style="color: #dc3545; text-align: center; padding: 20px;">Error loading requests</p>';
            }
        }

        async function approveRequest(requestId, userId, type, amount) {
            if (!confirm('Are you sure you want to APPROVE this request?')) return;

            try {
                // Update user balance
                const userDocRef = window.firebaseModules.doc(window.firebaseDb, 'users', userId);
                const userDoc = await window.firebaseModules.getDoc(userDocRef);
                const currentBalance = userDoc.data().balance || 0;

                const newBalance = type === 'deposit' ? currentBalance + amount : currentBalance - amount;
                
                await window.firebaseModules.updateDoc(userDocRef, {
                    balance: newBalance
                });

                // Update request status
                const requestDocRef = window.firebaseModules.doc(window.firebaseDb, 'pendingRequests', requestId);
                await window.firebaseModules.updateDoc(requestDocRef, {
                    status: 'approved'
                });

                // Update transaction in user's transactions
                const transRef = window.firebaseModules.collection(window.firebaseDb, 'users', userId, 'transactions');
                const transSnap = await window.firebaseModules.getDocs(transRef);
                
                transSnap.forEach(async (doc) => {
                    const trans = doc.data();
                    if (trans.status === 'pending' && trans.amount === amount) {
                        await window.firebaseModules.updateDoc(doc.ref, {
                            status: 'approved',
                            type: type === 'deposit' ? '‚úÖ Deposit (Approved)' : '‚úÖ Withdrawal (Approved)'
                        });
                    }
                });

                alert('‚úÖ Request approved successfully!');
                loadPendingRequests();
                updateAdminStats();

            } catch (error) {
                console.error('Error approving request:', error);
                alert('‚ùå Failed to approve request. Please try again.');
            }
        }

        async function rejectRequest(requestId, userId, type, amount) {
            if (!confirm('Are you sure you want to REJECT this request?')) return;

            try {
                // Update request status
                const requestDocRef = window.firebaseModules.doc(window.firebaseDb, 'pendingRequests', requestId);
                await window.firebaseModules.updateDoc(requestDocRef, {
                    status: 'rejected'
                });

                // Update transaction in user's transactions
                const transRef = window.firebaseModules.collection(window.firebaseDb, 'users', userId, 'transactions');
                const transSnap = await window.firebaseModules.getDocs(transRef);
                
                transSnap.forEach(async (doc) => {
                    const trans = doc.data();
                    if (trans.status === 'pending' && trans.amount === amount) {
                        await window.firebaseModules.updateDoc(doc.ref, {
                            status: 'rejected',
                            type: type === 'deposit' ? '‚ùå Deposit (Rejected)' : '‚ùå Withdrawal (Rejected)'
                        });
                    }
                });

                alert('‚úÖ Request rejected successfully!');
                loadPendingRequests();
                updateAdminStats();

            } catch (error) {
                console.error('Error rejecting request:', error);
                alert('‚ùå Failed to reject request. Please try again.');
            }
        }

        async function logout() {
            try {
                await window.firebaseModules.signOut(window.firebaseAuth);
                currentUser = null;
                currentUserData = null;
                isAdmin = false;
                showScreen('welcomeScreen');
                console.log('‚úÖ Logged out successfully');
            } catch (error) {
                console.error('Logout error:', error);
                alert('‚ùå Failed to logout. Please try again.');
            }
        }

        function adminLogout() {
            isAdmin = false;
            showScreen('welcomeScreen');
        }

        // Initialize on page load
        console.log('üíé Sterling Vault Banking Platform Loaded');
        console.log('üî• Firebase Integration Active');
    </script>
</body>
</html>

